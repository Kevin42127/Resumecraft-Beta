# PDF 匯出優化指南

## 概述

本文檔詳細說明如何確保所有履歷模板在匯出 PDF 時都能完美產出，特別針對 C# 後端 PDF 生成服務進行優化。

## 主要優化內容

### 1. 專用 PDF 樣式檔案

創建了 `styles/pdf-export.css` 檔案，包含：

- **基礎設定**：確保透明背景、正確字體、行高等
- **移除干擾元素**：移除所有陰影、邊框、圓角、外框等
- **移除所有背景**：確保所有背景色都設為透明
- **移除所有外框**：確保所有邊框、外框、陰影完全移除
- **修復定位問題**：將 absolute/fixed 定位改為 relative
- **確保文字顏色**：修復白色文字在 PDF 中的顯示問題
- **修復佈局**：確保網格、flex 佈局正確顯示
- **修復間距**：確保所有 padding、margin 正確
- **修復字體**：確保字體大小、粗細、行高正確
- **修復顏色主題**：確保各模板的顏色主題正確顯示
- **修復列表和表格**：確保列表樣式和表格佈局正確
- **修復圖片**：確保圖片正確顯示
- **修復特定模板**：針對每個模板的特殊樣式進行修復

### 2. PDF 匯出 Hook 優化

在 `hooks/useResumeExport.ts` 中：

- **HTML 清理**：移除可能影響 PDF 的 CSS 類別
- **樣式內嵌**：將所有 CSS 內嵌到 HTML 中
- **專用樣式覆蓋**：添加 PDF 專用的樣式覆蓋
- **響應式修復**：確保響應式設計在 PDF 中正確工作

### 3. C# API 優化

在 `app/api/generate-pdf/route.ts` 中：

- **視窗大小設定**：設定 A4 尺寸和高解析度
- **樣式注入**：注入額外的 PDF 優化樣式
- **等待時間**：確保內容完全載入
- **PDF 設定**：優化 PDF 生成參數

## 測試方法

### 1. 使用 PDF 測試頁面

訪問 `/pdf-test` 頁面進行測試：

1. 點擊「載入範例資料」載入測試內容
2. 選擇不同的模板查看效果
3. 點擊「匯出 PDF」測試匯出功能
4. 檢查 PDF 是否完美顯示所有內容

### 2. 測試檢查清單

對於每個模板，檢查以下項目：

#### 基礎檢查
- [ ] 背景是否為透明
- [ ] 文字是否清晰可讀
- [ ] 字體大小是否正確
- [ ] 間距是否適當
- [ ] 沒有多餘的陰影或邊框
- [ ] 沒有背景色干擾
- [ ] 沒有外框或邊框樣式
- [ ] 沒有圓角或裝飾效果

#### 佈局檢查
- [ ] 網格佈局是否正確
- [ ] Flex 佈局是否正確
- [ ] 響應式設計是否正確
- [ ] 沒有內容被截斷

#### 內容檢查
- [ ] 個人資料是否完整顯示
- [ ] 工作經驗是否正確格式化
- [ ] 教育背景是否正確顯示
- [ ] 技能列表是否正確
- [ ] 自訂區段是否正確顯示

#### 顏色檢查
- [ ] 主題顏色是否正確
- [ ] 文字顏色是否清晰
- [ ] 背景色是否為透明
- [ ] 沒有顏色顯示問題
- [ ] 沒有背景色干擾

## 常見問題解決

### 1. 文字顯示問題

**問題**：白色文字在 PDF 中不可見
**解決**：在 PDF 樣式中將 `.text-white` 改為黑色

### 2. 佈局錯亂

**問題**：網格或 flex 佈局在 PDF 中錯亂
**解決**：確保所有 display 屬性正確設定

### 3. 間距問題

**問題**：間距在 PDF 中不正確
**解決**：使用 `!important` 強制覆蓋間距樣式

### 4. 顏色問題

**問題**：顏色在 PDF 中不正確
**解決**：使用 `-webkit-print-color-adjust: exact` 確保顏色正確

### 5. 背景問題

**問題**：PDF 中有不想要的背景色
**解決**：使用 `background: transparent !important` 移除所有背景

### 6. 外框問題

**問題**：PDF 中有不想要的邊框、外框、陰影
**解決**：使用 `border: none !important`、`outline: none !important`、`box-shadow: none !important` 移除所有外框樣式

### 7. 分頁問題

**問題**：內容在頁面間被截斷
**解決**：使用 `page-break-inside: avoid` 避免不當分頁

## 環境變數設定

確保以下環境變數正確設定：

```env
# 使用 C# PDF 服務
NEXT_PUBLIC_USE_CSHARP_PDF=true

# C# PDF API 端點
NEXT_PUBLIC_CSHARP_PDF_API=http://localhost:5000/generate-pdf
```

## 性能優化

### 1. 圖片優化
- 確保圖片大小適中
- 使用適當的圖片格式
- 避免過大的圖片檔案

### 2. 字體優化
- 使用系統字體
- 避免自訂字體載入
- 確保字體回退機制

### 3. CSS 優化
- 移除不必要的樣式
- 合併重複的樣式規則
- 使用高效的選擇器

## 維護指南

### 1. 新增模板時
- 在 `styles/pdf-export.css` 中添加特定樣式
- 在 `hooks/useResumeExport.ts` 中添加清理規則
- 在 PDF 測試頁面中添加測試

### 2. 更新樣式時
- 確保同時更新 PDF 專用樣式
- 測試所有模板的 PDF 匯出
- 檢查是否有新的樣式衝突

### 3. 定期檢查
- 每月檢查所有模板的 PDF 匯出
- 更新測試資料
- 檢查新的瀏覽器相容性問題

## 結論

通過以上優化，所有履歷模板都能在 C# 後端服務的支援下完美匯出 PDF。關鍵在於：

1. **專用樣式檔案**：確保 PDF 專用的樣式覆蓋
2. **完整的測試**：使用測試頁面驗證所有模板
3. **持續維護**：定期檢查和更新樣式
4. **性能優化**：確保匯出速度和品質

這樣可以確保用戶在任何時候都能獲得高品質的 PDF 履歷檔案。 